<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Strategist Dashboard</title>
  <style>
    body { font-family: Arial; margin: 20px; background: #f4f4f4; }
    h1 { color: #333; }
    .section { margin-bottom: 30px; padding: 20px; background: #fff; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    .allocation-bar { height: 20px; background: #ddd; border-radius: 10px; overflow: hidden; margin-bottom: 5px; }
    .allocation-fill { height: 100%; background: #4caf50; text-align: right; color: white; padding-right: 5px; font-size: 12px; }
    .watchlist-item { margin-bottom: 5px; }
    button { padding: 10px 20px; font-size: 16px; background: #0078D4; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #005a9e; }
  </style>
</head>
<body>
  <h1>Strategist Dashboard</h1>
  <button onclick="runAnalysis()">Esegui Analisi</button>
  <div id="output"></div>

  <script>
    async function runAnalysis() {
      const res = await fetch('http://127.0.0.1:5000/api/run_analysis', {
        method: 'POST'
      });
      const data = await res.json();
      render(data);
    }

    function render(data) {
      const container = document.getElementById('output');
      container.innerHTML = '';

      const summary = document.createElement('div');
      summary.className = 'section';
      summary.innerHTML = `<h2>Sintesi</h2>
        <p><strong>Watchlist Totale:</strong> ${data.summary.total_watchlist.join(', ')}</p>
        <p><strong>Note:</strong> ${data.summary.notes}</p>`;
      container.appendChild(summary);

      for (const [name, rec] of Object.entries(data.by_philosophy)) {
        const section = document.createElement('div');
        section.className = 'section';
        section.innerHTML = `<h2>${name}</h2>`;

        // Watchlist
        const wl = rec.watchlist.map(w => `<div class="watchlist-item">ðŸŸ¢ ${w.symbol} (score: ${w.score})</div>`).join('');
        section.innerHTML += `<h3>Watchlist</h3>${wl || '<p>Nessun titolo selezionato.</p>'}`;

        // Allocazione
        section.innerHTML += `<h3>Allocazione</h3>`;
        for (const [asset, pct] of Object.entries(rec.allocation)) {
          section.innerHTML += `
            <div>${asset}</div>
            <div class="allocation-bar">
              <div class="allocation-fill" style="width:${pct * 100}%">${(pct * 100).toFixed(1)}%</div>
            </div>`;
        }

        // Rationale
        section.innerHTML += `<h3>Motivazioni</h3><ul>${rec.rationale.map(r => `<li>${r}</li>`).join('')}</ul>`;

        container.appendChild(section);
      }
    }
  </script>
</body>
</html>